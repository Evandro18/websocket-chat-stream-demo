let e,t,o,n,r;const a=document.getElementById("recordButton");let c=!1,l=0;async function s(){try{let e=document.querySelector("#wsUrl")?.value;o=new WebSocket(`${e}?language=en-US`),c=!0,a.textContent="Stop Recording",o.onopen=async()=>{let e=document.querySelector("#llmPrompt").value;msgPrompt={type:"prompt",value:e},o.send(JSON.stringify(msgPrompt)),function(e){navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:16e3}}).then(t=>{let o=n.createMediaStreamSource(t),r=n.createScriptProcessor(1024,1,1);o.connect(r),r.connect(n.destination),r.onaudioprocess=t=>{let o=t.inputBuffer.getChannelData(0),n=new Int16Array(o.length);for(let e=0;e<o.length;e++)n[e]=Math.max(-32768,Math.min(32767,32767*o[e]));e.readyState===WebSocket.OPEN&&e.send(n.buffer)}}).catch(e=>{console.error("getUserMedia error:",e)})}(o)},o.onerror=e=>{i(),console.error("WebSocket error:",e)},o.onclose=()=>{i(),console.log("WebSocket connection closed")},o.onmessage=async e=>{if(e.data instanceof Blob){let t=new FileReader;t.onload=async()=>{let e=t.result,o=new Int16Array(e);if(latestBufferSize=o.byteLength,o.length>0)try{await navigator.locks.request("audio-playback",async()=>{await u(o)})}catch(e){console.error("Error playing audio:",e)}else console.log("Received empty audio data after conversion")},t.readAsArrayBuffer(e.data)}else console.log(e.data)}}catch(e){console.error("Error starting recording:",e)}}function i(){t&&t.stop(),e&&e.getTracks().forEach(e=>e.stop()),o&&(console.log("Closing web socket"),o.close()),c=!1,a.textContent="Start Recording"}async function u(e){let t=new Float32Array(e.length);for(let o=0;o<e.length;o++)t[o]=e[o]/32768;let o=r.createBuffer(1,t.length,24e3);o.getChannelData(0).set(t);let n=r.createBufferSource();n.buffer=o,n.connect(r.destination);let a=o.length/o.sampleRate;l<r.currentTime&&(l=r.currentTime),n.start(l),console.log("Next buffer time:",l+=a)}document.querySelector("form").onsubmit=function(e){return e.preventDefault(),c?i():s(),n?"suspended"===n.state&&n.resume():(n=new AudioContext({sampleRate:16e3}),r=new AudioContext({sampleRate:24e3})),l=r.currentTime,!1},new Uint8Array;
//# sourceMappingURL=index.44203d75.js.map
