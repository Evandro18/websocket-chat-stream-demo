let e,t,o,n,r;const a=document.getElementById("recordButton");let c=!1,s=0;async function l(){try{(o=new WebSocket("ws://4.158.28.14:8080/ws/chat/chat123")).onopen=()=>console.log("WebSocket connection established"),o.onerror=e=>console.error("WebSocket error:",e),o.onclose=()=>console.log("WebSocket connection closed"),o.onmessage=async e=>{if(e.data instanceof Blob){let t=new FileReader;t.onload=async()=>{let e=t.result,o=new Int16Array(e);if(latestBufferSize=o.byteLength,o.length>0)try{await navigator.locks.request("audio-playback",async()=>{await i(o)})}catch(e){console.error("Error playing audio:",e)}else console.log("Received empty audio data after conversion")},t.readAsArrayBuffer(e.data)}else console.log(e.data)},await function(e){navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:16e3}}).then(t=>{let o=n.createMediaStreamSource(t),r=n.createScriptProcessor(1024,1,1);o.connect(r),r.connect(n.destination),r.onaudioprocess=t=>{let o=t.inputBuffer.getChannelData(0),n=new Int16Array(o.length);for(let e=0;e<o.length;e++)n[e]=Math.max(-32768,Math.min(32767,32767*o[e]));e.readyState===WebSocket.OPEN&&e.send(n.buffer)},c=!0,a.textContent="Stop Recording"}).catch(e=>{console.error("getUserMedia error:",e)})}(o)}catch(e){console.error("Error starting recording:",e)}}async function i(e){let t=new Float32Array(e.length);for(let o=0;o<e.length;o++)t[o]=e[o]/32768;let o=r.createBuffer(1,t.length,24e3);o.getChannelData(0).set(t);let n=r.createBufferSource();n.buffer=o,n.connect(r.destination);let a=o.length/o.sampleRate;s<r.currentTime&&(s=r.currentTime),n.start(s),console.log("Next buffer time:",s+=a)}a.addEventListener("click",()=>{c?(t&&t.stop(),e&&e.getTracks().forEach(e=>e.stop()),o&&(console.log("Closing web socket"),o.close()),c=!1,a.textContent="Start Recording"):l(),n?"suspended"===n.state&&n.resume():(n=new AudioContext({sampleRate:16e3}),r=new AudioContext({sampleRate:24e3})),s=r.currentTime}),new Uint8Array;
//# sourceMappingURL=index.835465fe.js.map
